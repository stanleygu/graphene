<svg ng-controller="sgSbmlLayoutCtrl" xmlns="http://www.w3.org/2000/svg" ng-attr-height="{{height || 800}}"
ng-attr-width="{{width || 800}}">
  <style>
  svg .node.species {
    stroke: #FFB800;
    stroke-width: 3px;
    size: 300px;
  }
  svg .link {
    stroke: black;
    stroke-width: 3px;
  }
  svg .link.modifier {
    stroke-dasharray: 5, 5;
  }
  svg .node-label {
    font-size: 14px;
    font-family: Georgia;
    font-weight: bolder;
    text-anchor: middle;
    dominant-baseline: middle;
  }
  /*  svg .node.selected {
    stroke: #FF0000;
  }
  svg .link.selected {
    stroke: #FF0000;
  }*/
  svg marker {
    overflow: visible;
  }
  svg .null-symbol {
    fill: none;
    stroke: black;
    stroke-width: 3px;
  }
  </style>
  <defs>
    <marker 
      case-sensitive="refX,refY" 
      id="production" 
      viewBox="0 0 10 10" 
      ng-attr-refX="{{-2}}"
      ng-attr-refY="{{0}}" 
      markerWidth="10" 
      markerHeight="10" 
      orient="auto">
      <path 
        fill="url(#markerGradient)" 
        stroke="#0013FF" 
        transform="rotate(-90)" 
        ng-attr-d="{{arrow({size: 10, type: 'triangle-down'})}}">
      </path>
    </marker>
    <marker 
      case-sensitive="refX,refY" 
      id="degradation" 
      viewBox="0 0 10 10" 
      ng-attr-refX="{{-2}}"
      ng-attr-refY="{{0}}" 
      markerWidth="10" 
      markerHeight="10" 
      orient="auto">
      <path 
        fill="url(#markerGradient)" 
        stroke="#0013FF" 
        transform="rotate(-90)" 
        ng-attr-d="{{arrow({size: 10, type: 'triangle-down'})}}"></path>
    </marker>
    <marker 
      case-sensitive="refX,refY" 
      id="modifier" 
      viewBox="0 0 10 10" 
      markerWidth="30"
      markerHeight="30" 
      ng-attr-refX="{{-0.4}}" 
      ng-attr-refY="{{0}}" 
      orient="auto">
      <path 
        stroke="black" 
        stroke-width="0.3" 
        fill="none" 
        ng-attr-d="{{arrow({size: 1, type: 'circle'})}}">
      </path>
    </marker>
    <linearGradient id="gradient">
      <stop offset="5%" stop-color="#FFDC9E"></stop>
      <stop offset="95%" stop-color="#FFF"></stop>
    </linearGradient>
    <linearGradient id="markerGradient">
      <stop offset="5%" stop-color="rgb(97, 116, 255)"></stop>
      <stop offset="95%" stop-color="#FFF"></stop>
    </linearGradient>
    <linearGradient id="reactionGradient">
      <stop offset="5%" stop-color="#B0C0FF"></stop>
      <stop offset="95%" stop-color="#FFF"></stop>
    </linearGradient>
  </defs>
  <g ng-attr-transform="translate({{translate.x || 0}}, {{translate.y || 0}})scale({{scale || 1}})">
    <g ng-repeat="link in lines.production">
      <line
        class="reaction production link"
        marker-end="url(#production)"
        ng-attr-x1="{{link.x1}}"
        ng-attr-y1="{{link.y1}}"
        ng-attr-x2="{{link.x2}}"
        ng-attr-y2="{{link.y2}}">
      </line>
    </g>
    <g ng-repeat="link in lines.reactant">
      <line 
        ng-click="App.selectReaction(link.target.id); isSelected = !isSelected" 
        ng-class="{selected: isSelected}" 
        class="reaction reactant link" 
        ng-attr-x1="{{link.x1}}"
        ng-attr-y1="{{link.y1}}" 
        ng-attr-x2="{{link.x2}}"
        ng-attr-y2="{{link.y2}}">
      </line>
    </g>
    <g>
      <line 
        ng-click="App.selectReaction(link.target.id); isSelected = !isSelected" 
        ng-repeat="link in lines.modifier"
        ng-class="{selected: isSelected}" 
        class="modifier link" 
        ng-attr-x1="{{link.x1}}"
        ng-attr-y1="{{link.y1}}" 
        ng-attr-x2="{{link.x2}}" 
        ng-attr-y2="{{link.y2}}"
        marker-end="url(#modifier)">
      </line>
    </g>
    <g
      ng-repeat="link in lines.source">
      <line
        class="source link"
        ng-attr-x1="{{link.x1}}"
        ng-attr-y1="{{link.y1}}" 
        ng-attr-x2="{{link.x2}}" 
        ng-attr-y2="{{link.y2}}"></line>
    </g>
    <g
      ng-repeat="link in lines.sink">
      <line
        class="sink link"
        ng-attr-x1="{{link.x1}}"
        ng-attr-y1="{{link.y1}}" 
        ng-attr-x2="{{link.x2}}" 
        ng-attr-y2="{{link.y2}}"
        marker-end="url(#production)"></line>
    </g>
    <g 
      draggable 
      ng-repeat="node in species" 
      ng-attr-transform="translate({{node.x}},{{node.y}})">
      <rect 
        ng-class="{selected: isSelected}" 
        class="species node"
        ng-attr-x="{{-node.width/2}}"
        ng-attr-y="{{-node.height/2}}"
        ng-attr-width="{{node.width}}" 
        ng-attr-height="{{node.height}}"
        ng-attr-ry="{{node.height/2}}"
        fill="url(#gradient)"
        ng-click="App.selectSpecies(node.id); isSelected = !isSelected;">
        <title>ID: {{node.id}}, Name: {{node.name}}</title>
      </rect>
      <text class="node-label">{{node.id | truncateTo:8}}</text>
    </g>
    <g 
      draggable 
      ng-repeat="node in reactions" 
      ng-attr-transform="translate({{node.x}},{{node.y}})">
      <circle 
        ng-class="node.classes" 
        class="node" 
        ng-attr-r="{{3}}"
        fill="black" 
        stroke="black"
        ng-click="openReactionModal(node)">
        <title>ID: {{node.id}}, Name: {{node.name}}</title>
      </circle>
      <text class="node-label">{{}}</text>
    </g>
    <g 
      draggable 
      ng-repeat="node in sourceNodes" 
      ng-attr-transform="translate({{node.x}},{{node.y}})">
      <g class="null-symbol">
        <circle 
          ng-attr-r="{{node.height / 2}}">
        </circle>
        <line 
          ng-attr-x1="{{-10}}" 
          ng-attr-y1="{{10}}"
          ng-attr-x2="{{10}}" 
          ng-attr-y2="{{-10}}">
        </line>
      </g>
    </g>
    <g 
      draggable 
      ng-repeat="node in sinkNodes" 
      ng-attr-transform="translate({{node.x}},{{node.y}})">
      <g class="null-symbol">
        <circle 
          ng-attr-r="{{node.height / 2}}">
        </circle>
        <line 
          ng-attr-x1="{{-10}}" 
          ng-attr-y1="{{10}}"
          ng-attr-x2="{{10}}" 
          ng-attr-y2="{{-10}}">
        </line>
      </g>
    </g>
  </g>
</svg>
